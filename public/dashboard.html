<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/alerta.css">
    <link rel="stylesheet" href="css/heade&footer.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <title>TillTheFangz | Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="buscarPeloId(sessionStorage.ID_USUARIO)">
    <header id="header"></header>
    <div id="containerSair"></div>
    <div id="div_Alerta" class="alerta">
        <img class="morcego" src="assets/img/morcegoCimaPreto.png">
        <div id="conteudo_alerta"></div>
    </div>
    <h1>Olá <strong id="nome"></strong></h1>
    <div class="kpis" style="display: flex; gap: 50px;">
        <div class="kpi usuarios">
            Quantidade de usuarios cadastrados:
            <h1 id="qtdUsuarios"></h1>
        </div>
        <div class="kpi media">
            Media de posts ao dia:
            <h1 id="MediaPosts">15</h1>
        </div>
    </div>

    <div class="dashboard">

        <h1>Dados Usuarios</h1>
        <div class="graficosUsuario">
            <div class="chart-card" >
                <p>Quantidade de pessoas com determinado interesse cadastradas</p>
                <canvas id="graficoInteresse" ></canvas>
            </div>
            <div class="chart-card" style="height: 370px; width: 350px;">
                <P>Quantidade de pessoas com determinado gênero cadastradas</P>
                <canvas id="graficoGeneros"> </canvas>
            </div>
        </div>



        <h1>Dados Personagens</h1>
        <div class="graficosUsuario">
            <div class="chart-card">
                <p>Atributos mais colocados em personagens</p>
                <canvas id="graficoAtributos"> </canvas>
            </div>

            <div class="chart-card">
                <p>Classes mais escolhidas pelos usuarios</p>
                <canvas id="graficoClasses"></canvas>
            </div>
        </div>
    </div>
</body>

</html>
<script src="js/header.js"></script>
<script src="js/div_alerta.js"></script>
<script>
    let nomeUsuario = sessionStorage.NOME_USUARIO
    nome.innerHTML = nomeUsuario
    let labelInteresse = ['Mestre', 'Player', 'Outro'];
    let labelGeneros = ['Feminino', 'Masculino', 'Outro'];
    let labelClasses = ['Caçador Sombrio', 'Senhor das Sombras', 'Bárbaro Noturno', 'Ilusionista Vampírico', 'Vampiro Cultista', 'Vampiro iluminado', 'Vampiro Flagelador', 'Vampiro Canibal', 'Nenhuma'];

    fetch(`/dashboard/listarPost`, {
        method: "GET"
    }).then(res => {
        res.json().then(json => {
            const mediaPost = json[0]
            console.log(mediaPost)
            MediaPosts.innerHTML = mediaPost.media
        })
    })

    fetch(`/dashboard/listarUsuario`, {
        method: "GET"
    }).then(res => {
        res.json().then(json => {
            const usuarios = json[0];
            console.log(usuarios)
            qtdUsuarios.innerHTML = usuarios.qtdUsuarios
        })
    })

    /*---------------------------------------------Gráfico de atributos---------------------------------------------*/
    // puxando os dados
    fetch(`/dashboard/listarAtributos`, {
        method: "GET"
    }).then(res => {
        res.json().then(json => {
            const atributos = json[0]
            /*Criação do gráfico de atributos*/
            let dadosAtributos = {
                labels: ["Carisma", "Inteligência", "Agilidade", "Vigor", "Sangue Ancestral"],
                datasets: [{
                    label: 'Atributos',
                    data: [atributos.TotalCarisma, atributos.TotalInteligencia, atributos.TotalAgilidade, atributos.TotalVigor, atributos.TotalSangueAncestral],
                    borderColor: 'rgba(255, 0, 0, 1)',
                    backgroundColor: 'rgba(255, 0, 0, 0.2)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(255, 0, 0, 1)'
                }]
            };

            const config = {
                type: 'bar',
                data: dadosAtributos,
                options: {
                    animation: {
                        duration: 150,
                        easing: 'easeOutBounce'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#f5f5f54b'
                            }
                        },
                        x: {
                            grid: {
                                color: '#f5f5f54b'
                            }
                        }
                    },
                    indexAxis: 'y',
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },

                }
            };


            let Atributos = new Chart(
                document.getElementById(`graficoAtributos`),
                config
            );
        })
    })

    /*---------------------------------------------Gráfico de Gêneros---------------------------------------------*/
    //puxando os dados
    fetch(`/dashboard/listarGeneros`, {
        method: "GET"
    }).then(res => {
        res.json().then(json => {
            const genero = json[0];
            console.log(genero)
            //Criando o gráfico
            let dadosGeneros = {
                labels: labelGeneros,
                datasets: [{
                    label: 'Gêneros',
                    data: [genero.QtdMulheres, genero.QtdHomens, genero.QtdOutros],
                    borderColor: 'rgba(255, 0, 0)',
                    tension: 0.1
                }]
            };
            const configGeneros = {
                type: 'doughnut',
                data: dadosGeneros,
                options: {
                    animation: {
                        duration: 150,
                        easing: 'easeOutBounce',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff',
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        }
                    }
                }
            };

            let generos = new Chart(
                document.getElementById(`graficoGeneros`),
                configGeneros
            );

        })
    })

    /*---------------------------------------------Gráfico de Classe---------------------------------------------*/
    //puxando dados
    fetch(`/dashboard/listarClasse`, {
        method: "GET"
    }).then(res => {
        res.json().then(json => {
            const classe = json[0];
            // Criando gráfico
            let dadosClasses = {
                labels: labelClasses,
                datasets: [{
                    label: 'Classes',
                    data: [classe.cacador, classe.senhor, classe.barbaro, classe.ilusionita, classe.cultista, classe.iluminado, classe.flagelador, classe.canibal, classe.nenhuma],
                    borderColor: 'rgba(255, 0, 0, 1)',
                    backgroundColor: 'rgba(255, 0, 0, 0.2)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(255, 0, 0, 1)'
                }]
            };
            const configClasses = {
                type: 'bar',
                data: dadosClasses,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#ffffff'
                        },
                        grid: {
                            color: '#f5f5f54b'
                        }
                    },
                    x: {
                        grid: {
                            color: '#f5f5f54b'
                        }
                    }
                },
            };

            let classes = new Chart(
                document.getElementById(`graficoClasses`),
                configClasses
            );

        })
    })


    /*Gráfico de Interesse*/
    //puxando dados
    fetch(`/dashboard/listarInteresse`, {
        method: "GET"
    }).then(res => {
        res.json().then(json => {
            const interesse = json[0];
            //criando gráfico
            let dadosInteresse = {
                labels: labelInteresse,
                datasets: [{
                    label: 'Interesse',
                    data: [interesse.Mestre, interesse.Player, interesse.Outros],
                    borderColor: 'rgba(255, 0, 0)',

                    tension: 0.1,
                    borderWidth: 2
                }],
                options: {
                    animation: {
                        duration: 1500,
                        easing: 'easeOutBounce'
                    },
                    plugins: {
                        id: 'custom-icons',
                        afterDatasetsDraw(chart, args, pluginOptions) {

                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true // Começar o eixo y em zero
                        }
                    }
                }
            }
            const configInteresse = {
                type: 'bar',
                data: dadosInteresse,
            };
            let Interesses = new Chart(
                document.getElementById(`graficoInteresse`),
                configInteresse
            );
        })
    })
</script>