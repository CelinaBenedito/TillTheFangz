<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/user.css">
    <link rel="stylesheet" href="../css/heade&footer.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <title>User</title>
</head>

<body onload="buscarPeloId(sessionStorage.ID_USUARIO)">
    <header id="header"></header>
    <div id="containerSair"></div>

    <div class="container">
        <div class="imgUser" id="imagem_usuario">
            <img src="assets/img/vampireUser.png" alt="">
        </div>


        <div class="nome">
            <h2 id="nickname"></h2>
            <h2 id="primeiro_nome">Nome</h2>
            <h2 id="sobrenome">Sobrenome</h2>
        </div>
        <p id="pronomes" class="pronomes">Pronomes</p>
        <button class="editarBotao" onclick="Editar()">Editar Perfil</button>
        <dialog id="editar">
            <div class="containerEditar">
                <h1>Editar Perfil</h1>


                <!-- Imagem do usuário -->
                <div class="editarIMG">
                    Imagem de Perfil:
                    <input type="file" id="foto" accept="image/*">
                </div>

                <!-- Nickname -->
                <div>
                    Nickname:
                    <input type="text" id="nicknameInput" placeholder="Digite seu nickname">
                </div>

                <!-- Pronomes -->
                Pronomes:
                <input type="text" id="pronomesInput" placeholder="Ex: ele/dele, ela/dela...">

                <!-- Descrição -->
                Descrição:
                <textarea id="descricaoInput" rows="3" maxlength="500" placeholder="Fale um pouco sobre você..." oninput="qtdCaracteres()"></textarea>
                <div class="avisoCaracteres">
                    <p id="avisoCaracteres"></p>
                </div>
                <!-- Botões -->
                <div class="botoesDialog">
                    <button type="submit" onclick="enviar()">Salvar</button>
                    <button type="button" onclick="document.getElementById('editar').close()">Cancelar</button>
                </div>

            </div>
        </dialog>

        <p id="descricao">Adicionar Descrição</p>
        <div class="parteTags">
            <h3>Tags:</h3>

            <div class="espaçoParaTags">
                <p id="tag"></p>
                <div>
                    <button>+</button>
                </div>
            </div>


        </div>
        <div class="partePersonagens">
            <h3>Personagens:</h3>
            <div class="botaoCriarficha">
                <a href="ficha.html">
                    <button>+</button>
                </a>
            </div>
            <a onclick="abirTela()">
                <div class="cardPersonagem">
                    <div class="nomePersonagem">
                        <p id="nomeclatura">Nome ou apelido</p>
                    </div>
                    <div class="infos">
                        <p id="pts_vida">Vida</p>
                        <p id="pts_sanidade">Sanidade</p>
                        <p id="classe">Classe</p>
                    </div>
                </div>
            </a>
            <dialog id="infosPersonagem">
                <div class="informacoes">
                    <img src="assets/img/vampireUser.png" alt="">
                    <h1>Nome ou Apelido</h1>
                    <div class="pontosBasicos">
                        <div class="itemBase">vida <p id="vida">0</p>
                        </div>
                        <div class="itemBase">sanidade <p id="sanidade">0</p>
                        </div>
                        <div class="itemBase">Defesa <p id="defesa">0</p>
                        </div>
                    </div>

                    <h3>Historia do Personagem</h3>
                    <p id="historiaPersonagem">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius velit
                        saepe asperiores, repudiandae quam labore cum modi? Et cum nemo, repudiandae dolores minima illo
                        vero dolor, officiis ducimus, aspernatur error?
                    </p>
                    <h3>Cracteristicas do Personagem</h3>
                    <p id="caracteristicasPersonagem">
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Reprehenderit delectus voluptatum
                        totam, temporibus, accusantium ducimus doloremque sapiente deleniti voluptates adipisci
                        cupiditate labore quos et magnam sit! Cumque vero quos explicabo.
                    </p>

                    <div class="botaoFechar">
                        <button onclick="fecharTela()">Fechar</button>
                    </div>
                </div>


            </dialog>
        </div>
        <div class="ferramentas">
            <h2>Posts:</h2>
            <button> <i class='bx bx-edit'></i> novo post</button>
        </div>
        <div class="partePosts">
            <div class="card">
                <div class="cabecalho">
                    <img src="assets/img/vampireUser.png" id="imagem_usuario_pequeno">
                    <p id="nickname_card">NickName</p>
                    <div class="tags">
                        <p id="tagPost"></p>
                    </div>
                </div>
                <div class="conteudo">
                    <div class="imagem">
                        <img src="" id="imagemPost">
                    </div>

                    <p id="conteudoPost"></p>
                </div>

                <div class="interacoes">
                    <div class="likes item">
                        <a href="" id="like"><i class='bx bx-heart'></i></a>Likes
                    </div>

                    <div class="comentarios item">
                        <a href="" id="comentarios"><i class='bx bxs-message-square-dots'></i></a>Comentários
                    </div>

                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-links">
            <h4>Links Rápidos</h4>
            <ul>
                <li><a href="/sobre.html">Sobre Mim</a></li>
            </ul>
        </div>
        <div class="footer-copyright">
            <p>&copy; 2025 Till the FangZ. Todos os direitos reservados.</p>
        </div>
    </footer>
</body>

</html>
<script src="js/header.js"></script>

<script>

    function qtdCaracteres(){
        let descricao = descricaoInput.value;
        let tamanhoDescricao = descricao.length;
        let quantidadeRestante = 500-tamanhoDescricao;
        avisoCaracteres.innerHTML = `Caracteres usados: ${tamanhoDescricao}`
        if(quantidadeRestante<100){
            avisoCaracteres.innerHTML = `Caracteres usados: <strong>${tamanhoDescricao}</strong>
        <br> Caracteres disponiveis <strong>${quantidadeRestante}</strong>`
        }
    }

    function buscarPeloId(id_user) {

        fetch(`/usuarios/${id_user}`, {
            method: "GET"
        })
            .then(res => {
                res.json().then(json => {
                    const usuario = json[0];
                    primeiro_nome.innerHTML = `${usuario.nome}`
                    sobrenome.innerHTML = `${usuario.sobrenome}`
                    if (usuario.nickname != (undefined || false || null)) {
                        nickname.innerHTML = `${usuario.nickname}`
                        primeiro_nome.innerHTML = ``
                        sobrenome.innerHTML = ``

                    }
                    imagem_usuario.innerHTML = `<img src='assets/imagensdePerfil/${usuario.ImagemUsuario}' alt="imagem de usuario">`
                    imagem_usuario_header.innerHTML = `<img src='assets/imagensdePerfil/${usuario.ImagemUsuario}' alt="imagem de usuario">`
                    imagem_usuario_pequeno.innerHTML = `<img src='assets/imagensdePerfil/${usuario.ImagemUsuario}' alt="imagem de usuario">`

                })

            })
            .catch(err => {
                console.log(err);
                
            })

    }

    function abirTela() {
        infosPersonagem.showModal()
    }

    function fecharTela() {
        infosPersonagem.close()
    }

    function Editar() {
        editar.showModal()
    }

    function enviar() {
        const formData = new FormData();
        formData.append('foto', foto.files[0])
        let ID_USUARIO = sessionStorage.ID_USUARIO;
        let nicknameVar = nicknameInput.value;

        nickname.innerHTML = nicknameVar

        fetch(`/usuarios/cadastro/${ID_USUARIO}`, {
            method: "POST",
            body: formData
        })
            .catch(err => {
                console.log("Caiuno catch")
                console.log(err);
            })
        return window.location.reload();
    }
</script>