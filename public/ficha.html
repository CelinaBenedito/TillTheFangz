<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/heade&footer.css">
    <link rel="stylesheet" href="../css/Ficha.css">
    <link rel="stylesheet" href="../css/alerta.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Ficha</title>
</head>

<body onload="logado(), buscarPeloId(sessionStorage.ID_USUARIO)">
    <header id="header"></header>
    <div id="containerSair"></div>
    <div id="div_Alerta" class="alerta">
        <img class="morcego" src="assets/img/morcegoCimaPreto.png">
        <div id="conteudo_alerta"></div>
    </div>
    <div class="conteudoMutavel" id="div_conteudo">
        <div id="botao"></div>
    </div>
    <div class="conteudo">
        <div id="div_conteudoInicio" class="inicial">

        </div>
    </div>
    <div class="conteudo">
        <div class="inicial" id="div_conteudoClasse">

        </div>
    </div>
    <div class="conteudo">
        <div class="inicial" id="div_conteudoAtributos">

        </div>
    </div>

    <div id="botaozao" class="big-botao">
        <button onclick="salvarInfos()">Salvar Ficha</button>
    </div>
    <dialog id="FichaCompleta">

    </dialog>

</body>
<script src="js/header.js"></script>
<script src="js/inners.js"></script>
<script src="js/div_alerta.js"></script>
<script>
    botaozao.style.display = "none"
    let pontosAtributosTotais = 10;
    let pontosVida = 20;
    let pontosSanidade = 20;
    let pontosDefesa = 5;
    let armadura = 0;
    let gerarInicio = false;
    let gerarClasse = false;
    let classes = {};
    let pontos = {
        carisma: 0,
        inteligencia: 0,
        agilidade: 0,
        vigor: 0,
        sangue: 0,
    };
    let elementos = {};
    let ID_USUARIO = sessionStorage.ID_USUARIO;

    function logado() {
        if (sessionStorage.ID_USUARIO != undefined) {

            fetch(`/personagens/listar/${ID_USUARIO}`, {
                method: "GET"
            })
                .then(res => {
                    res.json().then(json => {
                        const personagem = json[0];

                        console.log(json.length)
                        if (personagem.id != undefined) {
                            botao.innerHTML = `
                            <div class="criarBotao"> 
                                <button onclick="inicio()">
                                    <i class='bx bx-plus-medical'></i>
                                </button>
                            </div>`
                            for (let c = 0; json.length > c; c++) {
                                let personagem = json[c]
                                div_conteudo.innerHTML +=
                                    `
                                       <a onclick="${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}.showModal()">
                                            <div class="cardPersonagem">
                                                <div class="nomePersonagem">
                                                    <p id="nomeclatura">${personagem.apelido} - ${personagem.nome}</p>
                                                </div>
                                                <div class="infos">
                                                    <div>
                                                    <p id="pts_vida">Vida</p> ${personagem.vida}
                                                    </div>
                                                    <div>
                                                    <p id="pts_sanidade">Sanidade</p> ${personagem.sanidade}
                                                    </div>
                                                    <div>
                                                    <p id="classe">Classe</p> ${personagem.classe}
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                        <dialog id="${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}">
                                             <div class="informacoes">
                                                
                                                <h1>${personagem.apelido}</h1>
                                                <h2>${personagem.nome}</h2>
                                                <div class="pontosBasicos">
                                                    <div class="itemBase">Vida:<p id="vida"></p>
                                                    </div>
                                                    <div class="itemBase">Sanidade: <p id="sanidade"></p>
                                                        </div>
                                                    <div class="itemBase">Defesa: <p id="defesa"></p>
                                                    </div>
                                                </div>
                                                <div class="infosBase">
                                                    <p>Altura: ${personagem.altura}</p>
                                                    <p>Peso: ${personagem.peso}</p>
                                                    <p>Idade: ${personagem.idade}</p>
                                                    <p>Gênero: ${personagem.genero}</p>
                                                </div>
                                                <div class="detalhesTexto">
                                                    <div class="texto">
                                                    <h3>Historia do Personagem</h3>
                                                    <p id="historiaPersonagem">
                                                        ${personagem.historia}
                                                    </p>
                                                    </div>
                                                    <div class="texto">
                                                        <h3>Caracteristicas do Personagem</h3>
                                                        <p id="caracteristicasPersonagem">
                                                            ${personagem.caracteristicas}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div class="classe">
                                                    <h3>Classe: </h3>
                                                    <p>
                                                        ${personagem.classe}
                                                    </p>    
                                                </div>
                                                <div id="grafico${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}" class="grafico" style="width: 50%; height: 50%" >
                                                    <h3>Atributos</h3>
                                                    <canvas id="graficoAtributos${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}" style="background-color: rgb(10, 7, 7); border-radius: 15px;" ></canvas>
                                                </div>
                                              
                                                <div class="botaoFechar">
                                                    <button onclick="${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}.close()">Voltar</button>
                                                </div>
                                            </div>
                                        </dialog>
                                    `
                                if (personagem.carisma == 0 && personagem.inteligencia == 0 && personagem.agilidade == 0 && personagem.vigor == 0 && personagem.SangueAncestral == 0) {
                                    const idPersonalizadoPersonagem = ` grafico${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}`
                                    idPersonalizadoPersonagem.innerHTML =
                                        `
                    <h3>Atributos</h3>
                    <p>Nenhum ponto adicionado</p>
                    `
                                } else {

                                    const idPersonalizadoPersonagem = `graficoAtributos${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, "")}_${c}`
                                    setTimeout(() => {
                                        let canvas = document.getElementById(`graficoAtributos${personagem.nome.replaceAll(/[^a-zA-Z0-9]/g, '')}_${c}`);
                                        if (canvas) {
                                            let dadosAtributos = {
                                                labels: ['Carisma', 'Inteligência', 'Agilidade', 'Vigor', 'Sangue Ancestral'],
                                                datasets: [{
                                                    label: 'Atributos',
                                                    data: [personagem.carisma, personagem.inteligencia, personagem.agilidade, personagem.vigor, personagem.SangueAncestral],
                                                    borderColor: 'rgba(255, 0, 0, 1)',
                                                    backgroundColor: 'rgba(255, 0, 0, 0.2)',
                                                    borderWidth: 2,
                                                    pointBackgroundColor: 'rgba(255, 0, 0, 1)'
                                                }]
                                            };
                                            const config = {
                                                type: 'radar',
                                                data: dadosAtributos,
                                                options: {
                                                    animation: {
                                                        duration: 150,
                                                        easing: 'easeOutBounce',
                                                        responsive: true,
                                                        maintainAspectRatio: false,
                                                    },
                                                    scales: {
                                                        r: {
                                                            beginAtZero: true,
                                                            min: 0,
                                                            max: 5,
                                                            ticks: {
                                                                stepSize: 1,
                                                                display: false
                                                            },
                                                            grid: {
                                                                color: 'rgba(255, 255, 255, 0.582)'
                                                            },
                                                            pointLabels: {
                                                                color: 'white',
                                                                font: {
                                                                    size: 14,
                                                                    family: 'Arial',
                                                                    weight: 'bold'
                                                                }
                                                            }
                                                        }
                                                    },
                                                    elements: {
                                                        line: {
                                                            borderWidth: 3
                                                        }
                                                    }
                                                }
                                            };

                                            let atributos = new Chart(
                                                document.getElementById(`${idPersonalizadoPersonagem}`),
                                                config
                                            );
                                        }
                                    }, 50);
                                }
                            }

                        }
                        else {
                            div_conteudo.innerHTML =
                                `
                        <div class="inicia centralizarl">
                            <h2>Nenhum personagem encontrado!</h2>
                            <button onclick="inicio()"><i class='bx bx-plus-medical'></i> Criar Personagem</button>
                        </div>
                        `
                        }

                    })
                })


        }
        else {

            div_conteudo.innerHTML = `
             <div class="inicial">
            <h2>Logar para ver os personagens</h2>
            <br<br>
            <button onclick="window.location='login.html'">Logar</button>
            </div>
            `
        }
    }


    function inicio() {
        div_conteudo.style.display = "none"
        div_conteudoInicio.style.display = ""
        div_conteudoClasse.style.display = "none"
        div_conteudoAtributos.style.display = "none"

        botaozao.style.display = "block"
        if (gerarInicio == false) {
            gerarInicio = true;
            div_conteudoInicio.innerHTML = textoInicio
        }
    }

    function classe() {
        div_conteudoInicio.style.display = "none"
        div_conteudoAtributos.style.display = "none"

        botaozao.style.display = ""
        div_conteudoClasse.style.display = ""
        if (gerarClasse == false) {
            gerarClasse = true
            div_conteudoClasse.innerHTML = textoClasse
        }
        classes = {
            cacador: document.getElementById('cacador'),
            barbaro: document.getElementById('barbaro'),
            ilusionista: document.getElementById('ilusionista'),
            senhor: document.getElementById('senhor'),
            cultista: document.getElementById('cultista'),
            iluminado: document.getElementById('iluminado'),
            flagelador: document.getElementById('flagelador'),
            canibal: document.getElementById('canibal')
        };
    }

    function aparecer(item) {
        classes[item].showModal();

        if (classes['cacador']) {
            desc_cacador.innerHTML = `
                <h3>Caçador Sombrio</h3>
        <p>
            Diferente de outros vampiros que matam por necessidade ou prazer imediato, o Caçador Sombrio se deleita no
            jogo da caça. Ele rastreia suas presas por dias, até semanas, estudando cada movimento antes de atacar. Seus
            sentidos, já sobre-humanos, foram aguçados ao ponto de perceber o menor sussurro no vento ou o mais tênue
            cheiro de medo.
        </p>
        <ul>
            <li>
                Agilidade aumentada: Aumenta a chance de esquiva e ataques furtivos.[+3 pontos de agilidade]
            </li>
            <li>
                Habilidade de perseguição: Pode rastrear presas com facilidade, seus sentidos foram treinados ao
                máximo.[vantagem nas trilhas sensoriais, qualquer teste sensorial tem vantagem.]
            </li>
            <li>
                Resistência a ataques furtivos: Difícil de ser pego de surpresa por outros vampiros ou caçadores. [+2
                pontos de Sangue Ancestral]
            </li>
        </ul>
        <h4>Desvantagens:</h4>
        <p>
            Obcecado pela Caça: O Caçador Sombrio não consegue resistir ao impulso de caçar. Sempre que está diante de
            uma presa em potencial, precisa realizar um teste de Inteligência para evitar persegui-la, independentemente
            da situação. Falhar no teste pode colocá-lo e seus aliados em risco.
        </p>
        <p>
            Isolamento Natural: A natureza predatória do Caçador Sombrio o torna antissocial. Ele tem dificuldade em
            formar laços ou cooperar com outros. [-2 de carisma]
        </p>
        <h3>Resumo:</h3>
        <div class="grid">
            <div class="caixa">+3 de agilidade</div>
            <div class="caixa">+2 sangue ancestral</div>
            <div class="caixa">vantagem na trilha sensorial</div>
            <div class="caixa">-2 carisma</div>
        </div>
        <br>
        <button onclick="fechar('cacador')">Fechar</button>
                `
        }

        if (classes['senhor']) {
            desc_senhor.innerHTML = `<h3>Senhor das Sombras</h3>
        <p>
            Na escuridão mais profunda, onde até mesmo outros vampiros hesitam em pisar, reside o Senhor das Sombras.
            Ele não apenas abraçou a noite — tornou-se parte dela. Seu domínio sobre as trevas vai além da simples
            ausência de luz; as sombras sussurram segredos proibidos, escondem-no de olhos indesejados e dobram-se à sua
            vontade.
        </p>
        <ul>
            <li>
                Controle mental aprimorado: Facilita a manipulação de criaturas fracas ou até humanos, forçando-os a
                fazer sua vontade.[vantagem na trilha da habilidade mental]
            </li>
            <li>
                as sombras o protegem e o ajudam a se defender contra os mal intencionados que tentam descobrir os seus
                segredos por meio de invasões[+2 pontos de inteligência e sangue ancestral]
            </li>
            <li>
                Transformação em névoa ou sombra: o senhor das sombras tem uma facilidade maior com todo o obscuro, ele
                ouve as sombras sussurrando em seu ouvido[vantagem na trilha das transformações de névoa e sombra]
            </li>
        </ul>
        <h4>Desvantagens:</h4>
        <p>
            Eco Sombrio – As sombras o ouvem tanto quanto ele as ouve. Seu constante contato com a escuridão perturba
            sua mente, tornando difícil distinguir realidade de ilusão. Sempre que tenta usar sua habilidade de Controle
            Mental ou Transformação Sombria, deve fazer um teste de Inteligência. Se falhar, escutará sussurros
            incoerentes ou falsas visões que podem levá-lo a tomar decisões erradas, ou até mesmo traí-lo no momento
            mais crucial.
        </p>
        <h3>Resumo:</h3>
        <div class="grid">
            <div class="caixa">+2 de inteligência</div>
            <div class="caixa">+2 sangue ancestral</div>
            <div class="caixa">vantagem na trilha da habilidade mental</div>
            <div class="caixa">vantagem na trilha das transformações de névoa e sombra</div>
        </div>
        <br>
        <button onclick="fechar('senhor')">Fechar</button>
        `
        }

        if (classes['barbaro']) {
            desc_barbaro.innerHTML = `
                <h3>Bárbaro Noturno</h3>
        <p>
            O Bárbaro Noturno é a encarnação da fúria e da brutalidade sob o manto da escuridão. Este vampiro é uma
            força imparável no campo de batalha, utilizando sua força bruta e resiliência sobrenatural para esmagar
            inimigos e resistir a ataques devastadores. Alimentado pela escuridão, sua fúria aumenta à medida que o
            combate se intensifica.
        </p>
        <h2>Vantagnes:</h2>
        <ul>
            <li>
                +2 Vigor (aumenta a vida e a resistência a ataques)
            </li>
            <li>
                vantagem na trilha da habilidade Força (dano físico aprimorado)
            </li>
        </ul>
        <h4>Desvantagens:</h4>
        <ul>
            <li>
                -2 Inteligência (impulsivo e focado na brutalidade)
            </li>
        </ul>
        <p>
            Força da Noite: Ataques físicos causam 1D4 de dano durante a noite ou em ambientes escuros.
            Pele de Ferro Sombria: A sua velocidade e defesa aumentam por sua vontade e ânsia pela batalha +5 de
            agilidade.
        </p>
        <h3>Resumo:</h3>
        <div class="grid">
            <div class="caixa">+2 de vigor</div>
            <div class="caixa">-2 de inteligência</div>
            <div class="caixa">vantagem na trilha da habilidade Força </div>
            <div class="caixa">1D4 de dano durante a noite</div>
        </div>
                <button onclick="fechar('barbaro')">Fechar</button>`
        }

        if (classes['ilusionista']) {
            desc_ilusionista.innerHTML = `
                <h3>Ilusionista Vampírico</h3>
        <p>
            O Ilusionista Vampírico é um mestre da manipulação mental e do engano. Capaz de distorcer a realidade e
            controlar as mentes daqueles ao seu redor, este vampiro utiliza suas habilidades para confundir inimigos,
            criar ilusões e assumir o controle do campo de batalha sem levantar um dedo. Suas artes sombrias são tanto
            uma arma quanto uma defesa, tornando-o um oponente imprevisível.
        </p>
        <ul>
            <li>
                +2 Inteligência (melhora o controle mental e resistência a manipulação)
            </li>
            <li>
                +2 Carisma (aperfeiçoa interações sociais e o poder de persuasão)
            </li>
            <li>
                O vampiro tem dificuldades com armas de combate físico e se dá melhor com armas e magias.
            </li>
        </ul>
        <p>
            Manipulação das Emoções: Capacidade de alterar os sentimentos e pensamentos de outras criaturas. [vantagem
            em testes de controle mental e persuasão].
        </p>
        <h4>Desvantagens:</h4>
        <p>
            Fragilidade Física: Menor resistência a ataques físicos<br>[-3 de vigor]
        </p>
        <h4>Itens iniciais</h4>
        <ul>
            <li>
                Um baralho completo
            </li>
            <li>
                Um pendulo
            </li>
            <li>
                2 moedas de ouro
            </li>
        </ul>
        <h3>Resumo:</h3>
        <div class="grid">
            <div class="caixa">+2 de Carisma</div>
            <div class="caixa">+2 de Inteligência</div>
            <div class="caixa">Vantagem em testes de controle mental e persuasão</div>
            <div class="caixa">Dificuldades com armas de combate físico</div>
            <div class="caixa">-3 vigor</div>
            <div class="caixa">Se dá melhor com armas e magias.</div>
        </div>
        <button onclick="fechar('ilusionista')">Fechar</button>
                `
        }

        if (classes['cultista']) {
            desc_cultista.innerHTML = `
            <h3>Vampiro Cultista</h3>
        <p>
            O Vampiro Cultista trilha o caminho das trevas, dedicando-se a forças malignas em busca de poder absoluto.
            Essa devoção concede acesso a magias sombrias, transformações demoníacas e uma conexão natural com armas
            demoníacas. No entanto, essa aliança cobra seu preço, afetando sua sanidade e tornando-o vulnerável a luz
            sagrada.
        </p>
        <ul>
            <li>
                +2 Sangue Ancestral (pela conexão com as forças malignas)
            </li>
            <li>
                +1 Inteligência (pela manipulação de magias e rituais)
            </li>
        </ul>
        <p>
            Afinidade Demoníaca: Armas demoníacas causam +2 de dano e não exigem testes de afinidade para uso.
            Mente Corrompida: Recebe vantagem em resistir a controle mental de outras criaturas, mas sofre desvantagem
            contra magias de luz e sagrada.
        </p>
        <p>
            Rituais de Sangue: Pode usar o próprio sangue para realizar rituais sombrios, sacrificando pontos de vida
            para ganhar bônus temporários em transformações ou habilidades.
        </p>
        <h4>Desvantagens</h4>
        <ul>
            <li>
                -1 Carisma (devido à aura perturbadora que emana)
            </li>
            <li>
                Caso fique muito tempo longe de sua divindade ele irá perder sanidade.
            </li>
        </ul>
        <h3>Divindades:</h3>
        <h4>Cthulhu, o caos</h4>
        <p>
            um monstro abissal, que apenas o pensar sobre já o enlouquece, os vampiros que o seguem adoram o caos e
            fazem as suas vontades.
        </p>
        <h4>Velka, a Senhora dos Lamentos</h4>
        <p>
            Deusa da tristeza e do amor perdido. Dizem que ela chora por cada alma condenada a vagar eternamente. Muitos
            vampiros românticos a veneram, buscando conforto ou redenção.
        </p>
        <h4>Draeven, o Devorador de Almas </h4>
        <p>
            Deus do terror e da loucura. Ele corrompe vampiros e mortais, transformando-os em criaturas bestiais.
            Adorado por cultistas que desejam se fundir com a escuridão absoluta.
        </p>
        <h4>Nytheris, a Dama do Eclipse</h4>
        <p>
            Deusa da noite eterna e do silêncio. Seus seguidores acreditam que a escuridão é um santuário e buscam viver
            na sombra.
        </p>
        <h4>Sanguara, a Guardiã da Maldição</h4>
        <p>

            Deusa que criou o primeiro vampiro. Seus seguidores acreditam que os vampiros são tanto um fardo quanto uma
            dádiva. Alguns a veneram buscando redenção, enquanto outros abraçam sua maldição.
        </p>
        <h4>Itens iniciais:</h4>
        <ul>
            <li>
                Um papel com algumas escritas antigas
            </li>
            <li>
                Sangue para ritual
            </li>
            <li>
                5 moedas de ouro
            </li>
            <li>
                Uma túnica surrada
            </li>
        </ul>
        <h3>Resumo:</h3>
                <div class="grid">
            <div class="caixa">+2 sangue ancestral</div>
            <div class="caixa">+ 1 de inteligência</div>
            <div class="caixa">-1 carisma</div>
            <div class="caixa">+2 de dano com armas demoníacas</div>
            <div class="caixa">Fraco a danos sagrados e de luz</div>
            <div class="caixa">Vantagens em testes de resistência a controle mental</div>
    </div>
    <br>

        <button onclick="fechar('cultista')">Fechar</button>
            `
        }

        if (classes['iluminado']) {
            desc_iluminado.innerHTML = `
                        <h3>Vampiro iluminado</h3>
        <p>
            O Vampiro Iluminado carrega consigo a fé e os princípios de sua vida passada. Lutando contra a corrupção
            inerente da maldição vampírica, ele busca manter sua humanidade e usar sua condição para proteger outros dos
            horrores que enfrentou. Sua conexão com o sagrado é única, permitindo-lhe empunhar armas abençoadas e
            resistir melhor a ataques de luz, mas sua relutância em aceitar a verdadeira natureza vampírica o torna
            menos poderoso em habilidades sombrias.
        </p>
        <ul>
            <li>+2 Carisma (pela presença inspiradora e aura de fé)</li>
            <li>
                +1 Inteligência (pela sabedoria acumulada de sua fé)
            </li>
            <li>
                -5 Sangue Ancestral (pela rejeição às forças malignas que alimentam o poder vampírico)
            </li>
        </ul>
        <p>
            <strong>Resistência Sagrada:</strong> Recebe 1d4 a menos de dano de ataques sagrados e de luz.
            <strong>Afinidade Abençoada:</strong> Armas abençoadas causam +2 de dano e podem ser imbuídas com efeitos de
            luz.
            <strong>Humanidade Preservada:</strong> Testes para resistir ao frenesi ou impulsos bestiais têm vantagem.
            Além disso, o Vampiro Iluminado mantém sua aparência mais humana, passando despercebido em ambientes
            sociais.
            a cada habilidade sombria adquirida o jogador deve rolar um teste para saber se Deus ainda o vê
        </p>
        <p>
            Sempre que o Vampiro Iluminado adquirir ou utilizar uma habilidade sombria, deve realizar um Teste de Fé
            para determinar se ainda mantém a conexão com sua divindade.
        </p>
        <ul>
            <li>
                Teste de Fé: 1D20 + Carisma
            </li>
            <li>
                Resultado 15 ou mais: A divindade ainda o vê com compaixão, sem penalidades.
            </li>
            <li>
                Resultado entre 10 e 14: A conexão enfraquece. O personagem perde 5 de sanidade.
            </li>
            <li>
                Resultado abaixo de 10: O personagem perde temporariamente as habilidades sagradas e recebe desvantagem
                em testes relacionados à fé até realizar um ritual de redenção.
            </li>
        </ul>
        <h4>Itens iniciais</h4>
        <ul>
            <li>
                um par de luvas brancas
            </li>
            <li>
                Uma bíblia de bolso
            </li>
            <li>
                5 moedas de ouro
            </li>
        </ul>
        <h3>Resumo:</h3>
        <div class="grid">
            <div class="caixa">+2 de carisma</div>
            <div class="caixa">+ 1 de inteligência</div>
            <div class="caixa">-5 de sangue ancestral</div>
            <div class="caixa"> Armas abençoadas causam +2 de dano</div>
            <div class="caixa">Testes para resistir ao frenesi ou impulsos bestiais têm vantagem</div>
            <div class="caixa">Sempre que o Vampiro Iluminado adquirir ou utilizar uma habilidade sombria, deve realizar um Teste de Fé</div>
            <br>
            <button onclick="fechar('iluminado')">Fechar</button>
                `
        }

        if (classes['flagelador']) {
            desc_flagelador.innerHTML = `
                        <h3>Vampiro flagelador
        </h3>
        <p>
            Para o Vampiro Flagelador, a dor não é um fardo, mas uma fonte de poder. Cada ferida, cada gota de sangue
            derramada é um catalisador que transforma sofrimento em força bruta. Eles são mestres em utilizar o próprio
            corpo como arma, infligindo dor a si mesmos para liberar habilidades devastadoras. Suas cicatrizes contam
            histórias de batalhas onde a agonia foi sua maior aliada.
        </p>
        <ul>
            <li>
                +3 Sangue Ancestral (capacidade de suportar e transformar dor em poder)
            </li>
            <li>
                +1 Agilidade (reflexos rápidos para ataques precisos e auto-flagelação controlada)
            </li>
            <li>
                -1 Carisma (a aparência macabra e comportamento perturbador afastam os outros)
            </li>
        </ul>
        <p>
            <strong>Dor Revigorante:</strong> Sempre que o Vampiro Flagelador recebe dano, ele dará +1 de dano no
            próximo turno.
            <strong>Tolerância Sobrenatural:</strong> Imune a efeitos de dor ou atordoamento que afetariam o foco ou
            movimento.
        </p>
        <h4>Desvantagens:</h4>
        <p>
            <strong>Dependente da Dor:</strong> Habilidades causam menos dano ou falham caso o Vampiro Flagelador esteja
            com vida cheia.
            <strong>Instabilidade Mental:</strong> Testes para resistir a efeitos mentais têm desvantagem, pois o
            sofrimento constante o deixa vulnerável a manipulações.
        </p>
        <h4>Itens Iniciais:</h4>
        <ul>
            <li>
                faca desgastada - 1d4 de dano
            </li>
            <li>
                frasco vazio
            </li>
            <li>
                3 moedas de bronze
            </li>
        </ul>
        <h3>Resumo: </h3>
        <div class="grid">
            <div class="caixa">+3 de sangue ancestral</div>
            <div class="caixa">+ 1 de agilidade</div>
            <div class="caixa">-1 de carisma</div>
            <div class="caixa">Recebeu um dano, dará +1 de dano no próximo turno</div>
            <div class="caixa">Imune a efeitos de dor ou atordoamento</div>
            <div class="caixa">Testes para resistir a efeitos mentais têm desvantagem</div>
        </div>
            <br>

        <button onclick="fechar('flagelador')">Fechar</button>
                `
        }

        if (classes['canibal']) {
            desc_canibal.innerHTML = `
                            <h3>Vampiro Canibal</h3>
        <p>
            O Vampiro Canibal é uma criatura temida até mesmo entre os da sua espécie. Alimenta-se do sangue de outros
            vampiros, extraindo deles não apenas sua vitalidade, mas também parte de seus poderes. No entanto, cada gota
            consumida o aproxima da loucura. Este vampiro vive no limite entre o poder absoluto e a autodestruição.
        </p>
        <h4>Bônus de Atributos:</h4>
        <ul>
            <li>+3 Sangue Ancestral e vigor(fortalece suas transformações e resistência)</li>
            <li>
                -2 Carisma (sua natureza predatória o torna assustador e repulsivo para outros vampiros)
            </li>
            <li>
                A classe canibal é uma das únicas que inflige o dano vital
            </li>
        </ul>
        <p>
            <strong>Predador da Noite:</strong> Ao consumir o sangue de outros vampiros, recupera rapidamente vida e
            ganha um bônus temporário diversos tipos de teste por 2 turnos.
            <strong>Fome Eterna:</strong> Sempre que um vampiro inimigo estiver a menos de 5 metros, o Vampiro Canibal
            sente sua presença e tem vantagem em rastreá-lo.
        </p>
        <h4>Desvantagens:</h4>
        <p>
            <strong>Perda de Sanidade:</strong> A cada vez que consome sangue vampírico, deve realizar um teste de
            Inteligência. Falhar no teste faz com que o Vampiro Canibal perca parte de sua sanidade.
            <strong>Rejeição Social:</strong> Outros vampiros percebem sua natureza predatória, tornando interações
            sociais com sua espécie extremamente difíceis.
        </p>
        <h4>Itens Iniciais:</h4>
        <ul>
            <li>
                Faca desgastada - 1d4 de dano

            </li>
            <li>
                Frasco vazio
            </li>
            <li>
                3 moedas de bronze
            </li>
        </ul>
         <h3>Resumo: </h3>
        <div class="grid">
            <div class="caixa">+3 de sangue ancestral</div>
            <div class="caixa">-2 de carisma</div>
            <div class="caixa">Inflige o dano vital</div>
            <div class="caixa">Sangue de vampiro recupera vida</div>
            <div class="caixa">Beber sangue de vampiro, teste de sanidade</div>
            <div class="caixa">Vantagem em rastreio</div>
        </div>
                <br>
                <button onclick="fechar('canibal')">Fechar</button>
                `
        }

    }

    function fechar(item) {
        classes[item].close()
    }

    let pontosCarisma = 0;
    let pontosInteligencia = 0;
    let pontosAgilidade = 0;
    let pontosVigor = 0;
    let pontosSangue = 0;

    function atributos() {
        div_conteudoClasse.style.display = "none"
        div_conteudoInicio.style.display = "none"

        botaozao.style.display = "block"
        div_conteudoAtributos.style.display = "block"

        div_conteudoAtributos.innerHTML = textoAtributos

        // Agora atribuimos os elementos aos campos
        elementos = {
            carisma: document.getElementById('qtd_carisma'),
            inteligencia: document.getElementById('qtd_inteligencia'),
            agilidade: document.getElementById('qtd_agilidade'),
            vigor: document.getElementById('qtd_vigor'),
            sangue: document.getElementById('qtd_sangue_ancestral'),
            totais: document.getElementById('pontos_totais'),
            vida: document.getElementById('qtd_vida'),
            sanidade: document.getElementById('qtd_sanidade'),
            defesa: document.getElementById('qtd_defesa')
        };

        // Atualiza os valores iniciais na tela
        atualizarExibicao();
    }

    function atualizarExibicao() {
        elementos.carisma.innerHTML = pontos.carisma;
        elementos.inteligencia.innerHTML = pontos.inteligencia;
        elementos.agilidade.innerHTML = pontos.agilidade;
        elementos.vigor.innerHTML = pontos.vigor;
        elementos.sangue.innerHTML = pontos.sangue;
        elementos.totais.innerHTML = pontosAtributosTotais;
        elementos.vida.innerHTML = pontosVida;
        elementos.sanidade.innerHTML = pontosSanidade;
        elementos.defesa.innerHTML = pontosDefesa;


    }

    function pontuação(numero, atributo) {

        if (numero === 1 && pontos[atributo] >= 5) {

            return funcao_alerta("Quantidade máxima alcançada");
        }
        if (numero === -1 && pontos[atributo] <= 0) {

            return funcao_alerta("Quantidade mínima alcançada");
        }
        if (numero === 1 && pontosAtributosTotais <= 0) {

            return funcao_alerta("Quantidade de pontos total acabou");
        }

        pontosAtributosTotais -= numero;
        pontos[atributo] += numero;
        pontosVida = 20 * pontos.vigor;
        pontosSanidade = 20 + (10 * pontos.inteligencia)
        pontosDefesa = 5 + pontos.agilidade;
        console.log(pontosVida);
        if (pontosVida == 0) {
            pontosVida = 20;
        }
        pontosCarisma = pontos.carisma;
        pontosInteligencia = pontos.inteligencia;
        pontosAgilidade = pontos.agilidade;
        pontosVigor = pontos.vigor;
        pontosSangue = pontos.sangue;
        atualizarExibicao();

        // Animação
        /*let elementoAlterado = elementos[atributo];

        elementoAlterado.classList.add("troca");
        setTimeout(() => elementoAlterado.classList.remove("troca"), 300);
        elementos.totais.classList.add("troca");
        setTimeout(() => elementos.totais.classList.remove("troca"), 300);*/
    }


    let apelidoPersonagem = "Nenhum"
    let nomePersonagem = "Nenhum";
    let alturaPersonagem = "Nenhuma";
    let pesoPersonagem = "Nenhum";
    let classePersonagem = "Nenhuma";
    let generoPersonagem = "Nenhum";
    let idadePersonagem = "Nenhuma";
    let historiaPersonagem = "Nenhuma";
    let caracteristicasPersonagem = "Nenhuma"

    function salvarClasse(classe) {
        classePersonagem = classe;

        if (classe == "Caçador Sombrio") {
            pontos.carisma -= 2;
        }
    }
    function salvarInfos() {
        nomePersonagem = ipt_nome.value;
        alturaPersonagem = ipt_altura.value;
        pesoPersonagem = ipt_peso.value;
        apelidoPersonagem = ipt_apelido.value;
        generoPersonagem = select_genero.value;
        idadePersonagem = ipt_idade.value;
        historiaPersonagem = ipt_historia.value;
        caracteristicasPersonagem = ipt_caracteristicas.value;

        if (generoPersonagem === "#") {
            generoPersonagem = "Nenhum"
        }
        if (nomePersonagem === "") {
            nomePersonagem = 'Nenhum Nome Definido'
        }
        if (apelidoPersonagem === "") {
            apelidoPersonagem = "Nenhum Apelido Definido"
        }
        if (alturaPersonagem === "") {
            alturaPersonagem = 0
        }
        if (pesoPersonagem === "") {
            pesoPersonagem = 0
        }
        if (idadePersonagem == "") {
            idadePersonagem = 0
        }
        if (historiaPersonagem == "") {
            historiaPersonagem = "Nenhuma Historia Encontrada"
        }
        if (caracteristicasPersonagem == "") {
            caracteristicasPersonagem = "Nenhuma Caracteristica Encontrada"
        }
        //     pontos = {
        //     carisma: 0,
        //     inteligencia: 0,
        //     agilidade: 0,
        //     vigor: 0,
        //     sangue: 0,
        // };



        FichaCompleta.showModal()
        FichaCompleta.innerHTML =
            `
                    <div class="informacoes">
                    <img src="assets/img/vampireUser.png" alt="">
                    <h1>${apelidoPersonagem}</h1>
                    <h2>${nomePersonagem}</h2>
                    <div class="pontosBasicos">
                        <div class="itemBase">Vida:<p id="vida">${pontosVida}</p>
                        </div>
                        <div class="itemBase">Sanidade: <p id="sanidade">${pontosSanidade}</p>
                            </div>
                        <div class="itemBase">Defesa: <p id="defesa">${pontosDefesa}</p>
                        </div>
                    </div>
                    <div class="infosBase">
                        <p>Altura: ${alturaPersonagem}</p>
                        <p>Peso: ${pesoPersonagem}</p>
                        <p>Idade: ${idadePersonagem}</p>
                        <p>Gênero: ${generoPersonagem}</p>
                    </div>
                    <div class="detalhesTexto">
                        <div class="texto">
                        <h3>Historia do Personagem</h3>
                        <p id="historiaPersonagem">
                            ${historiaPersonagem}
                        </p>
                        </div>
                        <div class="texto">
                            <h3>Caracteristicas do Personagem</h3>
                            <p id="caracteristicasPersonagem">
                                ${caracteristicasPersonagem}
                            </p>
                        </div>
                    </div>
                    <div class="classe">
                        <h3>Classe: </h3>
                        <p>
                            ${classePersonagem}
                        </p>    
                    </div>
                    <div id="grafico" class="grafico" style="width: 50%; height: 50%" >
                        <h3>Atributos</h3>
                        <canvas id="graficosAtributos" style="background-color: rgb(10, 7, 7); border-radius: 15px;"></canvas>
                    </div>

                    <div class="botaoFechar">
                        <button onclick="FichaCompleta.close()">Voltar para a ficha</button>
                        <button onclick="cadastrarPersonagem()"> Salvar ficha</button>
                    </div>
                    </div>
                    `

        if (pontos.carisma == 0 && pontos.inteligencia == 0 && pontos.agilidade == 0 && pontos.vigor == 0 && pontos.sangue == 0) {
            grafico.innerHTML =
                `
                    <h3>Atributos</h3>
                    <p>Nenhum ponto adicionado</p>
                    `
        }

        let dadosAtributos = {
            labels: ["Carisma", "Inteligência", "Agilidade", "Vigor", "Sangue Ancestral"],
            datasets: [{
                label: 'Atributos',
                data: [pontos.carisma, pontos.inteligencia, pontos.agilidade, pontos.vigor, pontos.sangue],
                borderColor: 'rgba(255, 0, 0, 1)',
                backgroundColor: 'rgba(255, 0, 0, 0.2)',
                borderWidth: 2,
                pointBackgroundColor: 'rgba(255, 0, 0, 1)'
            }]
        };

        const config = {
            type: 'radar',
            data: dadosAtributos,
            options: {
                animation: {
                    duration: 150,
                    easing: 'easeOutBounce',
                    responsive: true,
                    maintainAspectRatio: false,
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        min: 0,
                        max: 5,
                        ticks: {
                            stepSize: 1,
                            display: false
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.582)' // Linhas circulares
                        },
                        pointLabels: {
                            color: 'white', // Cor das labels nos pontos (nomes dos atributos)
                            font: {
                                size: 14,
                                family: 'Arial',
                                weight: 'bold'
                            }
                        }
                    }
                },
                elements: {
                    line: {
                        borderWidth: 3
                    }
                }
            }
        };

        let Atributos = new Chart(
            document.getElementById(`graficosAtributos`),
            config
        );


    }
    let atualizarPontosGerais = document.getElementById('pontos_Habilidade')
    let fkusuario = sessionStorage.ID_USUARIO;

    function cadastrarPersonagem() {

        fetch("/personagens/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fkusuarioServer: fkusuario,
                nomeServer: nomePersonagem,
                apelidoServer: apelidoPersonagem,
                idadeServer: idadePersonagem,
                pesoServer: pesoPersonagem,
                generoServer: generoPersonagem,
                alturaServer: alturaPersonagem,
                classeServer: classePersonagem,
                historiaServer: historiaPersonagem,
                caracteristicasServer: caracteristicasPersonagem
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);
                if (resposta.ok) {
                    return resposta.json();
                    //funcao_alerta("Personagem registrado com sucesso!");
                    //cadastrarPontos();
                    //return window.location.reload()
                } else {
                    funcao_alerta("Houve um erro")
                }
            }).then(function (dados) {
                const idPersonagem = dados.idPersonagem
                funcao_alerta("Personagem registrado com sucesso!");
                cadastrarPontos(idPersonagem);
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        return false;
    }


    function cadastrarPontos(idPersonagem) {
        console.log(`Pontos de Carisma: ${pontosCarisma}`)
        fetch("/personagens/cadastrarPontos", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fkpersonagemServer: idPersonagem,
                fkusuarioServer: fkusuario,
                pontosCarismaServer: pontosCarisma,
                pontosInteligenciaServer: pontosInteligencia,
                pontosAgilidadeServer: pontosAgilidade,
                pontosVigorServer: pontosVigor,
                pontosSangueServer: pontosSangue,
                pontosVidaServer: pontosVida,
                pontosDefesaServer: pontosDefesa,
                pontosSanidadeServer: pontosSanidade
            }),
        })
            .then(function (resposta) {
                console.log("Reposta cadastro pontos: ", resposta);
                if (resposta.ok) {
                    funcao_alerta("Pontos cadastrados com sucesso!")
                    return window.location.reload();
                } else {
                    funcao_alerta("Houve um erro")

                }
            })

    }
</script>